<ul class="timeline-single">

    <% 
    @revisions = Post.where(:ancestry => 1, :post_type => 'autosave').order('created_at desc')
    @revisions = (Post.where(:id => 1) + Post.where(:ancestry => 1, :post_type => 'autosave').order('created_at desc')) if @revisions.first.post_status.downcase == 'user-autosave'
    @revisions.each_with_index do |f, index| %>

      <% break if index == 5 %>
      <li>

        <% if f.post_status.downcase == 'user-autosave' || f.post_type.downcase == 'page' %>
          <div class="timeline-single-badge"><i class="fa fa-user"></i></div>
        <% else %>
          <div class="timeline-single-badge danger"><i class="fa fa-save"></i></div>
        <% end %>
        
        <div class="timeline-single-panel">

          <div class="timeline-single-heading">
            <% if (f.post_title != (@revisions[index+1].blank? ? "\r\n" : @revisions[index+1].post_title)) %>
            <h4 class="timeline-single-title">
              <label>Post Title:</label>
              <%= Differ.diff_by_word(f.post_title, @revisions[index+1].blank? ? "\r\n" : @revisions[index+1].post_title).format_as(:html).html_safe %>
            </h4>
            <% end %>
            <% if (f.post_slug != (@revisions[index+1].blank? ? "\r\n" : @revisions[index+1].post_slug)) %>
              <h4>
                <label>URL:</label>
                <%= Differ.diff_by_word('/' +f.post_slug, @revisions[index+1].blank? ? "\r\n" : '/' + @revisions[index+1].post_slug).format_as(:html).html_safe %>
              </h4>
            <% end %>

          </div>

          <div class="timeline-single-body">
            <% if (f.post_content != (@revisions[index+1].blank? ? "\r\n" : @revisions[index+1].post_content)) %>
              <label>Content:</label>
              <%= Diffy::Diff.new("#{f.post_content.to_s}", @revisions[index+1].blank? ? "\r\n" : "#{@revisions[index+1].post_content.to_s}", :include_plus_and_minus_in_html => true).to_s(:html_simple).html_safe %>
            <% end %>
            <hr>
            <div class="btn-group">
              <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">
                <i class="fa fa-cog"></i> <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li>
                  <%= link_to restore_admin_revision_path(f) do %>
                    <i class="fa fa-magic"></i> Restore
                  <% end %>   
                </li>
                <li>
                  <%= link_to edit_admin_revision_path(f) do %>
                    <i class="fa fa-search"></i> Compare to live version 
                  <% end %>
                </li>
              </ul>
            </div>
            <small class="text-muted pull-right"><i class="fa fa-clock-o"></i> <%= time_ago_in_words(f.updated_at) %> ago by <%= (f.post_status.downcase == 'user-autosave' || f.post_type.downcase == 'page') ? f.admin.username : 'system' %></small>
          </div>

        </div>

      </li>

    <% end %>

</ul>

<%= link_to edit_admin_revision_path(@revisions.first.id), :class => 'btn btn-primary btn-block pull-right view-all-revisions' do %>
  <i class="fa fa-search"></i> View All Revisions 
<% end %>
