<h2 class="title">
	File Browser 

	<small class="pull-right">size:- <%= get_bucket_size %></small>

</h2>   
<div class="row">
<% @files.each do |file| %>  
	<div class="span2">
		<div class="overlay">
			<img src="<%= download_url_for(file.key) %>" data-image="<%= download_url_for(file.key) %>">
		</div>
		<div class="actions">
			<%= link_to download_url_for(file.key), :target => "_blank" do %>
				<i class="icon-eye-open"></i>
			<% end %>
			<%= link_to "filebrowser/delete/?file=" + file.key, :confirm => 'Are you sure you want to delete ' + file.key + '?', :confirm => "Are you sure?" do %>
				<i class="icon-trash"></i>
			<% end %>
		</div>
	</div>  
<% end %>  
</div>
<div class="clearboth"></div>

<hr>

<div class="pull-left">
	
		<%= form_tag("/admin/filebrowser/upload", :method => "post", :multipart => true) do %>  
			<% if params[:manualBrowse] %>
			<%= hidden_field_tag 'manualBrowse', 'true' %>
			<% end %>
		    <%= file_field_tag "file" %>  
		    <%= submit_tag "Upload", :class => 'btn btn-warning' %>  
		<% end %>  
	</div>

	<div class="pull-right">

		<a href="https://console.aws.amazon.com/s3/" class="btn btn-warning">S3 Console</a>
	</div>



<% if params[:manualBrowse] %>

	<script type="text/javascript">
		
		$('.span2').on('dblclick', 'img', function(){
			var image = $(this).attr('data-image');

			sendUrl(image);
		});

		function sendUrl(image){
			window.opener.returnImageFunction(image)
			window.close();
		}

	</script>

<% else %>

	<script type="text/javascript">

		$('input[name=commit]').attr('disabled', 'disabled');

		$('#file').change(function(){
			if($(this).val() == ''){
				$('input[name=commit]').attr('disabled', 'disabled');
			} else {
				$('input[name=commit]').removeAttr('disabled');
			}
		})
		
		$('.span2').on('dblclick', 'img', function(){
			var image = $(this).attr('data-image');

			getUrl(1, image);
		});

		function getUrl(cback, image_file){
			window.opener.CKEDITOR.tools.callFunction(cback, image_file);
			window.close();
		}

	</script>


<% end %>
